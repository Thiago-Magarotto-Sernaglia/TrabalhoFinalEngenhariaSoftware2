<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Notebook Gamer - Sua Loja</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } </style>
    <script src="js/auth.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <a href="index.html" class="text-2xl font-bold text-indigo-600">SuaLogo</a>
                <div class="flex items-center space-x-4">
                    <a href="carrinho.html" class="text-gray-500 hover:text-indigo-600 relative">
                        <span class="sr-only">Carrinho</span>
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    </a>
                    <div id="menu-visitante">
                        <a href="login.html" id="nav-login" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">Entrar</a>
                    </div>
                    <div id="menu-usuario" class="hidden flex items-center space-x-4">
                        <span id="nav-user" class="text-sm text-gray-700"></span>
                        <a href="lista_pedidos.html" class="text-sm text-gray-500 hover:text-indigo-600" title="Meus Pedidos">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        </a>
                        <a href="minha_conta.html" class="text-sm text-gray-500 hover:text-indigo-600">Minha Conta</a>
                        <button id="btn-logout" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">Sair</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <!-- Breadcrumb -->
        <nav class="text-sm text-gray-500 mb-6">
            <ol class="list-none p-0 inline-flex">
                <li class="flex items-center"><a href="index.html" class="hover:text-indigo-600">Início</a><svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></li>
                <li class="flex items-center"><a href="produtos.html" class="hover:text-indigo-600">Produtos</a><svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></li>
                <li>Notebook Gamer</li>
            </ol>
        </nav>

        <div class="lg:grid lg:grid-cols-2 lg:gap-x-12 lg:items-start">
            <!-- Imagem -->
            <div class="flex flex-col-reverse">
                <div class="w-full aspect-w-1 aspect-h-1 bg-gray-200 rounded-lg overflow-hidden sm:aspect-w-2 sm:aspect-h-3 h-96 flex items-center justify-center">
                    <span class="text-gray-400 text-2xl">Imagem do Produto</span>
                </div>
            </div>

            <!-- Informações -->
            <div class="mt-10 px-4 sm:px-0 sm:mt-16 lg:mt-0">
                <h1 class="text-3xl font-extrabold tracking-tight text-gray-900">Notebook Gamer High-End</h1>
                
                <div class="mt-3">
                    <h2 class="sr-only">Informações do produto</h2>
                    <p class="text-3xl text-indigo-600">R$ 4.500,00</p>
                </div>

                <div class="mt-6">
                    <h3 class="sr-only">Descrição</h3>
                    <div class="text-base text-gray-700 space-y-6">
                        <p>O melhor desempenho para seus jogos e trabalhos pesados. Conta com placa de vídeo de última geração, processador veloz e tela de alta resolução.</p>
                    </div>
                </div>

                <form class="mt-6">
                    <!-- Botões de Ação -->
                    <div class="mt-10 flex sm:flex-col1">
                        <button type="button" class="max-w-xs flex-1 bg-indigo-600 border border-transparent rounded-md py-3 px-8 flex items-center justify-center text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-50 focus:ring-indigo-500 sm:w-full">
                            Adicionar ao Carrinho
                        </button>

                        <button type="button" class="ml-4 py-3 px-3 rounded-md flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-gray-500">
                            <!-- Ícone Coração (Wishlist) -->
                            <svg class="h-6 w-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                            <span class="sr-only">Adicionar à lista de desejos</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
<script>
    // Variável global para guardar o produto atual
    let produtoAtual = null;

    async function carregarDetalhes() {
        const urlParams = new URLSearchParams(window.location.search);
        const produtoId = urlParams.get('id');

        if (!produtoId) {
            alert('Produto não especificado.');
            window.location.href = 'produtos.html';
            return;
        }

        try {
            const response = await fetch(`http://localhost:8000/produtos/${produtoId}`);
            if (!response.ok) throw new Error('Produto não encontrado');

            produtoAtual = await response.json();

            // 1. Atualiza Textos Básicos
            document.title = `${produtoAtual.nome} - Sua Loja`;
            document.querySelector('h1.text-3xl').textContent = produtoAtual.nome;
            
            const preco = parseFloat(produtoAtual.preco || 0);
            const precoFormatado = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(preco);
            document.querySelector('p.text-3xl.text-indigo-600').textContent = precoFormatado;

            // Atualiza Breadcrumb
            const breadcrumbs = document.querySelectorAll('nav ol li');
            if(breadcrumbs.length > 2) breadcrumbs[2].textContent = produtoAtual.nome;

            // 2. Lógica de Estoque (NOVO)
            const estoqueDiv = document.querySelector('.mt-6'); // Reutilizando a div da descrição para mostrar estoque
            
            // Cria um elemento visual para o estoque
            const statusEstoque = document.createElement('p');
            statusEstoque.className = "mt-4 font-bold flex items-center";
            
            const btnComprar = document.querySelector('button[type="button"]'); // O primeiro botão

            if (produtoAtual.estoque > 0) {
                statusEstoque.innerHTML = `<span class="text-green-600">✓ Em estoque (${produtoAtual.estoque} ${produtoAtual.unidade})</span>`;
                // Ativa o clique do botão
                btnComprar.onclick = adicionarAoCarrinho;
            } else {
                statusEstoque.innerHTML = `<span class="text-red-600">⚠ Esgotado</span>`;
                // Desabilita o botão
                btnComprar.disabled = true;
                btnComprar.classList.add('opacity-50', 'cursor-not-allowed');
                btnComprar.textContent = "Indisponível";
            }
            
            estoqueDiv.appendChild(statusEstoque);

        } catch (error) {
            console.error(error);
            document.body.innerHTML = '<div class="text-center mt-20 text-red-600">Erro ao carregar produto. Verifique se o backend está rodando.</div>';
        }
    }

    // 3. Função de Adicionar ao Carrinho (NOVO)
    function adicionarAoCarrinho() {
        if (!produtoAtual) return;

        // Pega o carrinho atual do LocalStorage ou cria um array vazio
        let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

        // Verifica se o produto já está no carrinho
        const itemExistente = carrinho.find(item => item.id === produtoAtual.id);

        if (itemExistente) {
            itemExistente.qtd += 1; // Aumenta quantidade
        } else {
            carrinho.push({
                id: produtoAtual.id,
                nome: produtoAtual.nome,
                preco: parseFloat(produtoAtual.preco || 0),
                imagem: null, // Seu banco ainda não tem imagem, deixamos null
                qtd: 1
            });
        }

        // Salva de volta no navegador
        localStorage.setItem('carrinho', JSON.stringify(carrinho));

        alert(`"${produtoAtual.nome}" adicionado ao carrinho!`);
        
        // Opcional: Redirecionar para o carrinho
        // window.location.href = 'carrinho.html'; 
    }

    document.addEventListener('DOMContentLoaded', async () => {
        await initAuth(); // Inicializa sistema de autenticação
        carregarDetalhes();
    });
</script>
</body>
</html>